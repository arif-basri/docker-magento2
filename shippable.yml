language: php

php:
  - 7.1

build:  
  pre-ci:
    
  pre_ci_boot:
    options: "-v /app:/app"

  ci:
    - cp -R . /app    #copy checked out gitrepo from build container into build host for sharing with other containers spawned by the docker-compose
    - docker-compose -p fv -f shippable/docker-compose-shippable.yml up -d web db
    - sleep 10
    - docker exec fv_web_1 install-magento
    - docker exec fv_web_1 install-sampledata
    - docker exec fv_web_1 mkdir -p /app/testresults
    - docker exec fv_web_1 /var/www/html/vendor/bin/phpunit --log-junit /app/testresults/junit.xml -c /var/www/html/dev/tests/integration/phpunit.xml.dist

  post_ci:
    - cp -R /app/testresults/* testresults/    #copy test result from host into build container
    - docker-compose -p fv -f shippable/docker-compose-shippable.yml down
  
  on_failure:
    - cp -R /app/testresults/* $SHIPPABLE_BUILD_DIR/shippable/testresults/    #copy test result from host into build container
    - docker-compose -p fv -f shippable/docker-compose-shippable.yml down

notifications:
  email: false