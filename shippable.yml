language: php

php:
  - 7.1

build:  
  pre-ci:
    
  pre_ci_boot:
    options: "-v /app:/app"

  ci:
    - cp -R . /app    #copy checked out gitrepo from build container into build host for sharing with other containers spawned by the docker-compose
    - docker-compose -p fv -f shippable/docker-compose-shippable.yml up -d web db phpmyadmin
    - sleep 10
    - docker exec fv_web_1 install-magento
    - docker exec fv_web_1 install-sampledata
    - docker exec fv_web_1 /var/www/html/vendor/bin/phpunit --log-junit /app/testresults/junit.xml -c /var/www/html/dev/tests/unit/phpunit.xml.dist
    - cp -R /app/testresults/* testresults/    #copy test result from host into build container
    - docker-compose -p fv -f shippable/docker-compose-shippable.yml down
#    - /var/www/html/vendor/bin/phpunit --log-junit shippable/testresults/junit.xml -c dev/tests/functional/phpunit.xml.dist

notifications:
  email: false